# Windows OS Disk Write Cache

Windows 作業系統為了要提升使用者體驗，並加速系統運作速度，因此預設會對使用者寫入硬碟的資料作快取 (Cache)。也就是會預先分配一塊記憶體空間，並將使用者寫入的資料先存在記憶體中。此時系統會先告知使用者「寫入完成」，等待有空的時候再將資料慢慢寫進硬碟。

## 造成的問題

### DBMS 喪失 Durability

寫入快取最大的問題，就是會讓 DBMS 喪失 Durability。

這是因為當 DBMS Commit 一個 transaction 時，最低限度必須要將 log 寫入一個穩定儲存媒介，以確保資料不會遺失。但是 Windows 寫入快取的設計是回報使用者寫入成功時，並不是真的寫進硬碟，而是先存在一個記憶體位置，等待有空時再寫入。這會使 DBMS 喪失 Durability 的保證。


### 實驗不準確

另一個問題是，任何牽涉到檔案讀寫的實驗都會喪失真實性。

因為 Windows 利用快取避免掉 IO 的時間，使得實驗都無法反映出 IO 的影響。許多同學之前調整 Buffer Pool Size 效果不明顯，很有可能就是這個原因造成的。


## 關閉設定

### 步驟

要關閉 Windows 寫入快取的設定，請遵照以下步驟：

1. 打開「我的電腦」或「檔案總管」，對存放 Database 資料的硬碟(預設是 C 碟)按右鍵，選擇「內容」，開啟該分割槽的詳細視窗。
2. 選擇「硬體」頁籤，並在清單中對對應的實體硬碟點兩下，開啟該硬碟的設定視窗。
3. 選擇「原則」頁籤，並取消勾選「在裝置上啟用寫入快取」的項目。
4. 點選「確定」關閉設定與詳細視窗。
5. 完成

**注意：如果你是使用固態硬碟(SSD)進行測試，那 Windows 有可能會自動判定不需要寫入快取**

### 風險

關閉設定後，該硬碟上檔案的讀寫速度可能會急遽下降。如果是系統碟的話，可能會影響到 Windows 的效能。

建議不要將測試用的資料放置於系統碟上，修改 VanillaDB-Core 資料存放位置的方法可以參考[這裡][1]。

另外也建議實驗完畢後，將設定修改回去。



[1]: The_Location_of_Database_Files.md
